# -*- coding: utf-8 -*-
"""merged_kaggle_collected_news.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/19WtPEsVl6VXVBy8pMlgTC7I0paZRJoJl
"""

import pandas as pd

# 1) đọc kaggle news dataset
kaggle_df = pd.read_csv("kaggle_news_preprocess.csv")

# 1) đọc collected news dataset
collected_df = pd.read_csv("collected_news_preprocess.csv")

print(kaggle_df.shape)
kaggle_df.head()

print(collected_df.shape)
collected_df.head()

kaggle_df = kaggle_df.drop(columns=["Unnamed: 0", "category"])

collected_df = collected_df.drop(columns=["tok_phobert", "tok_vn_embed", "tok_vn_doc"])

kaggle_df["date"] = pd.to_datetime(kaggle_df["date"], errors="coerce")

collected_df["date"] = pd.to_datetime(collected_df["date"], errors="coerce")

kaggle_df.head()

collected_df.head()

# 4) Chỉ giữ các cột chung (để concat không lệch schema)
common_cols = sorted(set(kaggle_df.columns).intersection(collected_df.columns))
kaggle_df = kaggle_df[common_cols]
collected_df = collected_df[common_cols]

# 5) Gộp
combined_df = pd.concat([kaggle_df, collected_df], ignore_index=True)

# 6) Sort theo date
combined_df = combined_df.sort_values("date").reset_index(drop=True)

print(combined_df.shape)
combined_df.head()

combined_df = combined_df.set_index("date").sort_index()

# kiểm tra trùng index(date)
print("Rows with duplicated date index:", combined_df.index.duplicated(keep=False).sum())

combined_df

combined_df.shape

combined_df.info()

missing_title = combined_df[combined_df["title"].isna()]
print(missing_title.shape)
missing_title

titles = [
    "Lợi nhuận nhiều ngân hàng được dự báo tăng mạnh trong quí III/2020",
    "Giá USD chợ đen phá đỉnh 24.000 đồng, giá vàng chưa thể ngóc đầu",
    "Cập nhật giá vàng hôm nay trong nước và thế giới 27.8",
    "Giá vàng ngày 24/8: Vàng nhẫn neo ở mức đỉnh"
]

combined_df.loc[combined_df["title"].isna(), "title"] = titles

missing_title = combined_df[combined_df["title"].isna()]
print(missing_title.shape)
missing_title

combined_df.info()

!pip install wordcloud

from wordcloud import WordCloud
import matplotlib.pyplot as plt

# Giả sử cột đã là content_clean
text = " ".join(combined_df["content_clean"].astype(str).tolist())
len(text)

wc = WordCloud(
    width=1200,
    height=600,
    background_color="white"   # màu nền, còn màu chữ để mặc định
).generate(text)

plt.figure(figsize=(14, 7))
plt.imshow(wc, interpolation="bilinear")
plt.axis("off")
plt.show()

mask_2024 = combined_df.index >= "2024-01-01"
text_2024 = " ".join(combined_df.loc[mask_2024, "content_clean"].astype(str))

wc_2024 = WordCloud(
    width=1200,
    height=600,
    background_color="white"
).generate(text_2024)

plt.figure(figsize=(14, 7))
plt.imshow(wc_2024, interpolation="bilinear")
plt.axis("off")
plt.show()

mask_2025 = combined_df.index >= "2025-01-01"
text_2025 = " ".join(combined_df.loc[mask_2025, "content_clean"].astype(str))

wc_2025 = WordCloud(
    width=1200,
    height=600,
    background_color="white"
).generate(text_2025)

plt.figure(figsize=(14, 7))
plt.imshow(wc_2025, interpolation="bilinear")
plt.axis("off")
plt.show()

combined_df.to_csv("merged_kaggle_collected_news.csv", index=True, encoding="utf-8-sig")